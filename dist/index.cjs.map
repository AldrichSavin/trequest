{"version":3,"file":"index.cjs","sources":["../src/PluginEventEmitter.ts","../src/helpers.ts","../src/Core.ts","../src/EventEmitter.ts","../src/AbstractPlugin.ts","../src/Plugin.ts"],"sourcesContent":["import { PluginLifecycle, PluginDefine, Plugin } from \"./Plugin\";\nimport { IAbstractPlugin } from \"./AbstractPlugin\";\nimport Core, { MultiServiceBaseURLRecords } from \"./Core\";\nimport { EventProperties } from \"./EventEmitter\";\n\nexport interface PluginEventEmitterType extends Plugin, IAbstractPlugin {}\n\nexport default class PluginEventEmitter extends Set<PluginEventEmitterType> {\n  constructor(private readonly coreContext = {}) {\n    super();\n  }\n\n  public register(\n    plugin: PluginEventEmitterType[] | PluginEventEmitterType\n  ): void {\n    const plugins = Array.isArray(plugin) ? plugin : [plugin];\n    plugins.forEach((plugin) => {\n      this.add(plugin);\n      plugin.onRegister?.(this.coreContext);\n    });\n  }\n\n  public initPluginContext<UserMultiServiceBaseURLRecords = MultiServiceBaseURLRecords>(\n    plugins: PluginEventEmitterType[] | PluginEventEmitterType,\n    core: Core<UserMultiServiceBaseURLRecords, any>\n  ): void {\n    const pluginsArray = Array.isArray(plugins) ? plugins : [plugins];\n    pluginsArray.forEach((plugin) => {\n      plugin.setContext?.(core);\n    });\n    this.run(\"onInit\");\n  }\n\n  public unregister(plugin: PluginEventEmitterType): void {\n    this.delete(plugin);\n  }\n\n  /**\n   * filters plugins by lifecycle\n   *\n   * @param lifecycle PluginLifecycle\n   * @returns Plugin[Lifecycle][]\n   */\n  public filters<Lifecycle extends PluginLifecycle = PluginLifecycle>(\n    lifecycle: Lifecycle\n  ): PluginDefine[Lifecycle][] {\n    return Array.from(this)\n      .map((plugin) => {\n        if (plugin[lifecycle] && typeof plugin[lifecycle] === \"function\") {\n          return plugin[lifecycle]!.bind(plugin);\n        }\n        return undefined;\n      })\n      .filter(Boolean) as PluginDefine[Lifecycle][];\n  }\n\n  /**\n   * @title filters plugins by lifecycle and calls them\n   */\n  run<Lifecycle extends PluginLifecycle = PluginLifecycle>(\n    lifecycle: Lifecycle,\n    ...args: Parameters<PluginDefine[Lifecycle]>\n  ) {\n    const plugins = this.filters<Lifecycle>(lifecycle);\n    plugins.forEach((plugin) => {\n      plugin.apply(plugin, args);\n    });\n  }\n\n  /**\n   * @title filters plugins by lifecycle and calls them asynchronously\n   *\n   * @param lifecycle PluginLifecycle to filter\n   * @param args arguments to pass to the plugins lifecycle method (e.g. onInit)\n   * @returns Promise<ReturnType<PluginDefine[Lifecycle]>[]>\n   */\n  public runAsync<Lifecycle extends PluginLifecycle = PluginLifecycle>(\n    lifecycle: Lifecycle,\n    ...args: Parameters<PluginDefine[Lifecycle]>\n  ): Promise<ReturnType<PluginDefine[Lifecycle]>[]> {\n    const plugins = this.filters<Lifecycle>(lifecycle);\n    return Promise.all(\n      plugins.map((plugin) => {\n        return plugin.apply(plugin, args) as Promise<\n          ReturnType<PluginDefine[Lifecycle]>\n        >;\n      })\n    );\n  }\n\n  /**\n   * filters plugins by lifecycle and calls them synchronously\n   */\n  public async runSync<Lifecycle extends PluginLifecycle = PluginLifecycle>(\n    lifecycle: Lifecycle,\n    ...args: Parameters<PluginDefine[Lifecycle]>\n  ) {\n    for (const iterator of this.filters<Lifecycle>(lifecycle)) {\n      await iterator.apply(iterator, args);\n    }\n  }\n\n  /**\n   * @title filters plugins by lifecycle and calls them in an onion-like fashion\n   *\n   * @param lifecycle PluginLifecycle to filter\n   * @param args arguments to pass to the plugins lifecycle method (e.g. onInit)\n   * @returns ReturnType<PluginDefine[Lifecycle]> | undefined | void\n   */\n  public runOnion<Lifecycle extends PluginLifecycle = PluginLifecycle>(\n    lifecycle: Lifecycle,\n    ...args: Parameters<PluginDefine[Lifecycle]>\n  ): ReturnType<PluginDefine[Lifecycle]> | undefined | void {\n    const plugins = this.filters<Lifecycle>(lifecycle);\n    return plugins.reduce((prev, plugin) => {\n      return plugin.apply(plugin, args) ?? prev;\n    }, undefined);\n  }\n\n  /**\n   * @title filters plugins by lifecycle and calls them in an onion-like fashion asynchronously\n   *\n   * @param lifecycle PluginLifecycle to filter\n   * @param args arguments to pass to the plugins lifecycle method (e.g. onInit)\n   * @returns Promise<ReturnType<PluginDefine[Lifecycle]> | undefined | void>\n   */\n  public runOnionAsync<Lifecycle extends PluginLifecycle = PluginLifecycle>(\n    lifecycle: Lifecycle,\n    ...args: Parameters<PluginDefine[Lifecycle]>\n  ): Promise<ReturnType<PluginDefine[Lifecycle]> | undefined | void> {\n    const plugins = this.filters<Lifecycle>(lifecycle);\n    return plugins.reduce(async (prev, plugin) => {\n      const prevResult = await prev;\n      return plugin.apply(plugin, args) ?? prevResult;\n    }, Promise.resolve(undefined));\n  }\n\n  /**\n   * @title Find the plug-in by its name\n   */\n  getPluginByName(pluginName: EventProperties): PluginEventEmitterType | undefined {\n    return Array.from(this).find((plugin) => plugin.name === pluginName);\n  }\n}\n","export const isObject = (value: any): boolean => Object.prototype.toString.call(value) === \"[object Object]\"\nexport const isFunction = (value: any): value is Function => typeof value === 'function';\nexport const isString = (value: any): value is String => typeof value === 'string';","import PluginEventEmitter, {\n  PluginEventEmitterType,\n} from \"./PluginEventEmitter\";\nimport { CreateAxiosDefaults } from \"axios\";\nimport { AxiosInstance } from \"axios\";\nimport axios from \"axios\";\nimport { EventProperties } from \"./EventEmitter\";\nimport { AxiosRequestConfig } from \"axios\";\nimport { isObject, isString } from \"./helpers\";\nimport { AxiosResponse } from \"axios\";\n\nexport type MultiServiceBaseURLRecords = Record<string, string> & {\n  default?: string;\n};\n\nexport interface CoreConfig<\n  UserMultiServiceBaseURLRecords = MultiServiceBaseURLRecords,\n  D = any\n> extends Omit<CreateAxiosDefaults<D>, \"baseURL\"> {\n  plugins?: PluginEventEmitterType[];\n  instance?: AxiosInstance;\n  baseURL?:\n    | AxiosRequestConfig[\"baseURL\"]\n    | UserMultiServiceBaseURLRecords\n    | keyof UserMultiServiceBaseURLRecords;\n  /**\n   * global loading\n   */\n  loading?: boolean;\n\n  /**\n   * is worker env\n   */\n  worker?: boolean;\n}\n\nexport default class Core<\n  UserMultiServiceBaseURLRecords = MultiServiceBaseURLRecords,\n  D = any\n> extends PluginEventEmitter {\n  private readonly instance: AxiosInstance;\n\n  constructor(\n    private readonly coreConfig: CoreConfig<\n      UserMultiServiceBaseURLRecords,\n      D\n    > = {}\n  ) {\n    super();\n\n    // Mount plugins\n    this.mountPlugins();\n\n    // Init request instance\n    this.instance = axios.create({});\n\n    this.registerRequestInterceptor();\n    this.registerResponseInterceptor();\n  }\n\n  private mountPlugins(): void {\n    const { plugins = [] } = this.coreConfig;\n    this.register(plugins);\n    this.initPluginContext<UserMultiServiceBaseURLRecords>(plugins, this);\n  }\n\n  protected registerRequestInterceptor() {\n    this.instance.interceptors.request.use(\n      async (config) => {\n        this.run(\"onRequest\", config);\n        return config;\n      },\n      async (error) => {\n        const errors = await this.runOnionAsync(\"onError\", error);\n        this.run(\"onFinally\", errors || error);\n        return Promise.reject(errors || error);\n      }\n    );\n  }\n\n  protected registerResponseInterceptor() {\n    this.instance.interceptors.response.use(async (response) => {\n        const data = await this.runOnionAsync(\"onResponse\", response);\n        const result = data || response.data;\n        this.run(\"onFinally\", result);\n        return result;\n    }, async (error) => {\n        const errors = await this.runOnionAsync(\"onError\", error);\n        this.run(\"onFinally\", error);\n        return Promise.reject(errors || error);\n    })\n  }\n\n  protected isProtocol(url: string): boolean {\n    return /(http|https|ws|wss):\\/\\/([\\w.]+\\/?)\\S*/.test(url);\n  }\n\n  public getBaseURL(\n    baseURL?: AxiosRequestConfig[\"baseURL\"] | string\n  ): AxiosRequestConfig[\"baseURL\"] | string {\n    if (baseURL) {\n      /**\n       * If baseURL is passed during the request and is a valid http/https/ws/wss address,\n       * the passed baseURL is taken as the interface address and the request prefix is not automatically added\n       */\n      if (this.isProtocol(baseURL)) {\n        return baseURL;\n      }\n\n      /**\n       * Due to the internal extension of axios own baseURL attribute,\n       * it is possible to pass an object to baseURL when initializing the instance,\n       * with the corresponding key being any name and the value being the address of the service (e.g., api interface address).\n       *\n       * Therefore, when the estrus request, you can specify the key configured at the initialization of the baseURL,\n       * the internal will be mapped to the corresponding request prefix, and automatically added to the request\n       */\n      if (isObject(this.coreConfig.baseURL)) {\n        return (\n          (this.coreConfig.baseURL as MultiServiceBaseURLRecords)?.[baseURL] ||\n          baseURL\n        );\n      }\n\n      return baseURL;\n    }\n\n    // single service mode\n    if (isString(this.coreConfig.baseURL)) {\n      return this.coreConfig.baseURL;\n    }\n\n    /**\n     * In multiService mode, if the corresponding key cannot be found, try to find default\n     */\n    if (\n      isObject(this.coreConfig.baseURL) &&\n      Reflect.has(\n        (this.coreConfig.baseURL as MultiServiceBaseURLRecords) || {},\n        \"default\"\n      )\n    ) {\n      return Reflect.get(this.coreConfig.baseURL || {}, \"default\");\n    }\n\n    /**\n     * When a developer uses its own axios instance,\n     * it might set baseURL to the defaults property and finally try to look it up in defaults\n     */\n    return this.instance?.defaults?.baseURL || \"\";\n  }\n\n  public request<\n    Data = any,\n    D = any,\n    R extends AxiosResponse<any> = AxiosResponse<Data>\n  >(config: AxiosRequestConfig<D>): Promise<AxiosResponse<Data>> {\n    if (!this.instance?.request) {\n      throw new Error(\"HttpCore instance is not initialized\");\n    }\n    this.runOnionAsync(\"onBeforeRequest\", config);\n    return this.instance.request<Data, R, D>(\n      this.mergeConfig(config, {\n        baseURL: this.getBaseURL(config.baseURL),\n      })\n    );\n  }\n\n  protected mergeConfig(\n    config: AxiosRequestConfig,\n    userConfig: AxiosRequestConfig\n  ) {\n    return Object.assign({}, config, userConfig);\n  }\n}\n","export type EventProperties = string | symbol;\nexport type EventListener<T extends any[] = []> = (...args: [...T]) => void;\n\nexport default class EventEmitter extends Map<EventProperties, EventListener> {\n    constructor() {\n        super();\n    }\n\n    on<T extends any[] = []>(event: EventProperties, listener: EventListener<T>): EventEmitter {\n        this.set(event, listener);\n        return this;\n    }\n\n    emit<T extends any[] = []>(event: EventProperties, ...args: [...T]): boolean {\n        const listener = this.get(event);\n        if (listener) {\n            listener.apply(this, args);\n            return true;\n        }\n        return false;\n    }\n\n    off(event: EventProperties): EventEmitter {\n        this.delete(event);\n        return this;\n    }\n}","import EventEmitter from \"./EventEmitter\";\n\nexport interface IAbstractPlugin {\n    name: string | symbol;\n    version?: string;\n    setContext(context: Record<string | number | symbol, any>): void;\n    getContext(): any;\n}\n\nexport default abstract class AbstractPlugin extends EventEmitter {\n    /**\n     * The runtime context of the plug-in\n     */\n    private _context: {} = {};\n\n    constructor() {\n        super();\n    }\n    \n    /**\n     * The name of the plug-in\n     */\n    abstract name: string | symbol;\n\n    /**\n     * The version number of the plug-in\n     */\n    protected version?: string;\n\n    /**\n     * This function will be called when the plug-in is registered, \n     * passing the current runtime context to each plug-in so that the plug-in can communicate directly\n     */\n    protected setContext(context): void {\n        this._context = context;\n    }\n\n    /**\n     * You can get the runtime context inside the plugin by modifying the function\n     */\n    protected getContext(): any {\n        return this._context;\n    }\n}","export interface PluginDefine {\n    /**\n     * on register plugin\n     */\n    onRegister: (context) => any;\n\n    /**\n     * Called after the plug-in has been initialized\n     * You can get the context by this.getContext() and do more (you can customize it)\n     */\n    onInit: () => any;\n\n    /**\n     * Before sending the request (before the request is sent, you can modify the request)\n     */\n    onBeforeRequest: (request) => any;\n    \n    /**\n     * Between onBeforeRequest and onRequest,\n     * if a mock identity is provided in onMockRequest,\n     * it will respond directly to onResponse as simulated data\n     */\n    onMockRequest: (request) => void;\n\n    /**\n     * Send request\n     */\n    onRequest: (request) => any;\n\n    // Timeout/Abort/NetworkError/CustomerError/ServerError\n    onError: (error) => any;\n\n    /**\n     * Retry request\n     */\n    onRetry: (request) => any;\n\n    /**\n     * Cancel request (abort｜CancelToken.cancel)\n     */\n    onCancel: (request) => any;\n    \n    /**\n     * After receiving the response (you can modify the response)\n     */\n    onResponse: (response) => Promise<any> | any;\n\n    /**\n     * after all\n     */\n    onFinally: (response) => any;\n\n    /**\n     * destroy\n     */\n    destroy: () => any;\n}\n\nexport interface Plugin extends Partial<PluginDefine> {}\nexport type PluginLifecycle = keyof PluginDefine;\n\nexport default function Plugin() {}"],"names":["_settle","pact","state","value","_Pact","s","o","bind","v","prototype","then","onFulfilled","onRejected","result","this","callback","e","_this","_isSettledPact","thenable","PluginEventEmitter","_Set","coreContext","call","_inheritsLoose","_proto","register","plugin","_this2","Array","isArray","forEach","add","onRegister","initPluginContext","plugins","core","setContext","run","unregister","filters","lifecycle","from","map","filter","Boolean","_arguments","arguments","apply","slice","runAsync","_arguments2","Promise","all","runSync","_arguments3","_temp","_forOf","iterator","resolve","reject","runOnion","_arguments4","reduce","prev","_plugin$apply","undefined","runOnionAsync","_arguments5","prevResult","_plugin$apply2","getPluginByName","pluginName","find","name","_wrapNativeSuper","Set","isObject","Object","toString","Core","_PluginEventEmitter","coreConfig","instance","mountPlugins","axios","create","registerRequestInterceptor","registerResponseInterceptor","_this$coreConfig$plug","_this3","interceptors","request","use","config","error","errors","_this4","_this5","response","data","isProtocol","url","test","getBaseURL","baseURL","_this$instance","_this$coreConfig$base","Reflect","has","get","defaults","_this$instance2","Error","mergeConfig","userConfig","assign","EventEmitter","_Map","on","event","listener","set","emit","off","Map","_EventEmitter","AbstractPlugin","_context","version","context","getContext"],"mappings":"w9CAwDE,SAAAA,EAAAC,EAAAC,EAAAC,YAEG,GAAAA,aAAAC,EAAA,CACH,IAAGD,EACDE,cASFF,EAAAG,EAAAN,EAAAO,KAAA,KAAAN,EAAAC,IANQ,EAANA,IACAA,EAAAC,EAAeE,GAEfF,EAAGA,EAAAK,eASF,0DAKKN,MACCC,QAEIF,EAAAK,OAKZL,GAIE,CAAA,IApF0BG,eAAA,WAA7B,SAAAA,KA2CM,OA1CJA,EAAAK,UAAQC,KAAA,SAAAC,EAAAC,OADmBC,EAAW,IAAAT,EAEvCF,EAAAY,KAAAT,EAEM,GAAAH,EACL,CAEA,IAAAa,EAAgB,IAAaJ,EAASC,EACtC,GAAAG,EAAe,CACb,MACMF,WAAmBL,GAC3B,CAAA,MAAGQ,GACJhB,EAAAa,EAAA,EAAAG,EAEM,CAIL,OAAAH,CACA,CACE,OACFC,IACA,aACDR,EAAA,SAAAW,GAEM,IACL,IAAAd,EAAKc,EAAOT,EACb,EAAAS,EAAAZ,EAEDL,EAAAa,EAAA,EAAAF,EAAAA,EAAAR,GAAAA,yBAMO,CAAA,MACLa,GAEAhB,EAAAa,EAAY,EAAKG,EACd,CACC,GAEC,EACDZ,CACF,CA5CyB,YAyFtBc,EAAkBC,uBACDf,GAAiB,IAANC,CAChC,CA5FgB,IAAAe,wBAAmBC,GACtC,SAAAD,EAA6BE,GAAgBL,IAAAA,EAAA,gBAAhBK,IAAAA,EAAc,CAAE,IAC3CL,EAAAI,EAAAE,KAAAT,OAAQG,MADmBK,iBAAA,EAAAL,EAAWK,YAAXA,EAAgBL,CAE7C,CAHsCO,EAAAJ,EAAAC,GAGrC,IAAAI,EAAAL,EAAAX,iBAAAgB,EAEMC,SAAA,SACLC,GAAyDC,IAAAA,QAEzCC,MAAMC,QAAQH,GAAUA,EAAS,CAACA,IAC1CI,QAAQ,SAACJ,GACfC,EAAKI,IAAIL,GACTA,MAAAA,EAAOM,YAAPN,EAAOM,WAAaL,EAAKN,YAC3B,EACF,EAACG,EAEMS,kBAAA,SACLC,EACAC,IAEqBP,MAAMC,QAAQK,GAAWA,EAAU,CAACA,IAC5CJ,QAAQ,SAACJ,SACpBA,EAAOU,YAAPV,EAAOU,WAAaD,EACtB,GACAtB,KAAKwB,IAAI,SACX,EAACb,EAEMc,WAAA,SAAWZ,GAChBb,KAAI,OAAQa,EACd,EAACF,EAQMe,QAAA,SACLC,GAEA,OAAOZ,MAAMa,KAAK5B,MACf6B,IAAI,SAAChB,GACJ,GAAIA,EAAOc,IAA2C,mBAAtBd,EAAOc,GACrC,OAAOd,EAAOc,GAAYlC,KAAKoB,EAGnC,GACCiB,OAAOC,QACZ,EAACpB,EAKDa,IAAA,SACEG,GAC4C,IAAAK,EAAAC,UAE5BjC,KAAK0B,QAAmBC,GAChCV,QAAQ,SAACJ,GACfA,EAAOqB,MAAMrB,EAAMsB,GAAAA,MAAA1B,KAAAuB,EAAM,GAC3B,EACF,EAACrB,EASMyB,SAAA,SACLT,GAC4CU,IAAAA,EAAAJ,UAEtCZ,EAAUrB,KAAK0B,QAAmBC,GACxC,OAAOW,QAAQC,IACblB,EAAQQ,IAAI,SAAChB,GACX,OAAOA,EAAOqB,MAAMrB,KAAMsB,MAAA1B,KAAA4B,EAAM,GAGlC,GAEJ,EAAC1B,EAKY6B,QAAO,SAClBb,GAAoB,QAGOc,EAAAR,UAAAS,+uBAAAC,CAAJ3C,KAAK0B,QAAmBC,GAApCiB,SAAAA,GAAgDN,OAAAA,QAAAO,QACnDD,EAASV,MAAMU,KAAQT,MAAA1B,KAAAgC,OAAO7C,KACrC,WAAA,EAAA,UAAA0C,QAAAO,QAAAH,GAAAA,EAAA9C,KAAA8C,EAAA9C,0BACH,CAAC,MAAAM,GAAAoC,OAAAA,QAAAQ,OAAA5C,EAAAS,CAAAA,EAAAA,EASMoC,SAAA,SACLpB,GAC4C,IAAAqB,EAAAf,UAG5C,OADgBjC,KAAK0B,QAAmBC,GACzBsB,OAAO,SAACC,EAAMrC,GAAU,IAAAsC,EACrC,OAAiCA,OAAjCA,EAAOtC,EAAOqB,MAAMrB,EAAMsB,GAAAA,MAAA1B,KAAAuC,EAAM,KAACG,EAAID,CACvC,OAAGE,EACL,EAACzC,EASM0C,cAAA,SACL1B,GAIA,OADgB3B,KAAK0B,QAAmBC,GACzBsB,gBAAcC,EAAMrC,GAAU,IAAA,IAAAyC,EAAArB,iBAAAK,QAAAO,QAClBK,GAAItD,cAAvB2D,GAAU,IAAAC,EAChB,cAAAA,EAAO3C,EAAOqB,MAAMrB,EAAMsB,GAAAA,MAAA1B,KAAA6C,EAAM,KAACE,EAAID,CAAW,EAClD,CAAC,MAAArD,GAAA,OAAAoC,QAAAQ,OAAA5C,EAAA,CAAA,EAAEoC,QAAQO,aAAQO,GACrB,EAACzC,EAKD8C,gBAAA,SAAgBC,GACd,OAAO3C,MAAMa,KAAK5B,MAAM2D,KAAK,SAAC9C,UAAWA,EAAO+C,OAASF,CAAU,EACrE,EAACpD,CAAA,eAAAuD,EAvI6CC,MCPnCC,EAAW,SAAC1E,GAAwB,MAA0C,oBAA1C2E,OAAOrE,UAAUsE,SAASxD,KAAKpB,EAA4B,ECoCvF6E,eAGnBC,SAAAA,GAGA,SAAAD,EACmBE,GAGXjE,IAAAA,EAW6B,gBAdlBiE,IAAAA,EAGb,CAAE,IAENjE,EAAAgE,EAAA1D,kBALiB2D,gBAAA,EAAAjE,EAHFkE,cAGElE,EAAAA,EAAUiE,WAAVA,EAQjBjE,EAAKmE,eAGLnE,EAAKkE,SAAWE,EAAK,QAACC,OAAO,CAAA,GAE7BrE,EAAKsE,6BACLtE,EAAKuE,8BAA8BvE,CACrC,CAnBAO,EAAAwD,EAAAC,GAmBC,IAAAxD,EAAAuD,EAAAvE,iBAAAgB,EAEO2D,aAAA,WACN,IAAAK,EAAyB3E,KAAKoE,WAAtB/C,QAAAA,OAAU,IAAHsD,EAAG,GAAEA,EACpB3E,KAAKY,SAASS,GACdrB,KAAKoB,kBAAkDC,EAASrB,KAClE,EAACW,EAES8D,2BAAA,WAA0B,IAAA3D,EAG9Bd,KAAI4E,EAIiB5E,KANzBA,KAAKqE,SAASQ,aAAaC,QAAQC,IAAG,SAC7BC,GAAU,IAEf,OADAlE,EAAKU,IAAI,YAAawD,GACtB1C,QAAAO,QAAOmC,EACT,CAAC,MAAA9E,GAAA,OAAAoC,QAAAQ,OAAA5C,EAAA,CAAA,EAAA,SACM+E,GAAK,WAAI3C,QAAAO,QACO+B,EAAKvB,cAAc,UAAW4B,IAAMrF,cAAnDsF,GAEN,OADAN,EAAKpD,IAAI,YAAa0D,GAAUD,GACzB3C,QAAQQ,OAAOoC,GAAUD,EAAO,EACzC,CAAC,MAAA/E,GAAA,OAAAoC,QAAAQ,OAAA5C,EAEL,CAAA,EAAA,EAACS,EAES+D,4BAAA,WAA2BS,IAAAA,EAEZnF,KAAIoF,EAKFpF,KANzBA,KAAKqE,SAASQ,aAAaQ,SAASN,aAAWM,GAAQ,IAAI/C,OAAAA,QAAAO,QACpCsC,EAAK9B,cAAc,aAAcgC,IAASzF,KAAvD0F,SAAAA,GACN,IAAMvF,EAASuF,GAAQD,EAASC,KAEhC,OADAH,EAAK3D,IAAI,YAAazB,GACfA,CAAO,EAClB,CAAC,MAAAG,GAAAoC,OAAAA,QAAAQ,OAAA5C,EAAA,CAAA,EAAA,SAAS+E,GAAK,WAAI3C,QAAAO,QACMuC,EAAK/B,cAAc,UAAW4B,IAAMrF,cAAnDsF,GAEN,OADAE,EAAK5D,IAAI,YAAayD,GACf3C,QAAQQ,OAAOoC,GAAUD,EAAO,EAC3C,CAAC,MAAA/E,UAAAoC,QAAAQ,OAAA5C,EACH,CAAA,EAAA,EAACS,EAES4E,WAAA,SAAWC,GACnB,MAAO,yCAAyCC,KAAKD,EACvD,EAAC7E,EAEM+E,WAAA,SACLC,GAAgD,IAAAC,EAmBPC,EAjBzC,OAAIF,EAKE3F,KAAKuF,WAAWI,GACXA,EAWL5B,EAAS/D,KAAKoE,WAAWuB,WAE8B,OAAtDE,EAAA7F,KAAKoE,WAAWuB,cAAsC,EAAtDE,EAAyDF,KAKvDA,ED1H6D,iBC8HzD3F,KAAKoE,WAAWuB,QAChB3F,KAACoE,WAAWuB,QAOvB5B,EAAS/D,KAAKoE,WAAWuB,UACzBG,QAAQC,IACL/F,KAAKoE,WAAWuB,SAA0C,CAAA,EAC3D,WAGKG,QAAQE,IAAIhG,KAAKoE,WAAWuB,SAAW,GAAI,YAOhCC,OAAbA,OAAKvB,WAAkB,OAAVuB,EAAbA,EAAeK,eAAQ,EAAvBL,EAAyBD,UAAW,EAC7C,EAAChF,EAEMmE,QAAA,SAILE,OAA6BkB,EAC7B,GAAkB,OAAdA,EAAClG,KAAKqE,YAAL6B,EAAepB,QAClB,MAAU,IAAAqB,MAAM,wCAGlB,OADAnG,KAAKqD,cAAc,kBAAmB2B,GAC3BhF,KAACqE,SAASS,QACnB9E,KAAKoG,YAAYpB,EAAQ,CACvBW,QAAS3F,KAAK0F,WAAWV,EAAOW,WAGtC,EAAChF,EAESyF,YAAA,SACRpB,EACAqB,GAEA,OAAOrC,OAAOsC,OAAO,CAAE,EAAEtB,EAAQqB,EACnC,EAACnC,CAAA,CAtIDC,CAAQ7D,GCpCWiG,eAAa,SAAAC,GAC9B,SAAAD,IAAA,OACIC,EAAA/F,YACJT,IAAA,CAH8BU,EAAA6F,EAAAC,GAG7B,IAAA7F,EAAA4F,EAAA5G,UAmBA4G,OAnBA5F,EAED8F,GAAA,SAAyBC,EAAwBC,GAE7C,OADA3G,KAAK4G,IAAIF,EAAOC,GAEpB3G,IAAA,EAACW,EAEDkG,KAAA,SAA2BH,GACvB,IAAMC,EAAW3G,KAAKgG,IAAIU,GAC1B,QAAIC,IACAA,EAASzE,MAAMlC,KAAImC,GAAAA,MAAA1B,KAAAwB,UAAM,KAE5B,EAEL,EAACtB,EAEDmG,IAAA,SAAIJ,GAEA,OADA1G,KAAW,OAAC0G,GAEhB1G,IAAA,EAACuG,CAAA,CAtB6B,cAsB7B1C,EAtBqCkD,0CCMG,SAAAC,GAMzC,SAAAC,IAAA9G,IAAAA,EAYiBA,OAXbA,EAAA6G,EAAAvG,YAAOT,MAHHkH,SAAe,GAAE/G,EAcfgH,aAAOhH,EAAAA,CAVjB,CARyCO,EAAAuG,EAAAD,GAQxC,IAAArG,EAAAsG,EAAAtH,iBAAAgB,EAgBSY,WAAA,SAAW6F,GACjBpH,KAAKkH,SAAWE,CACpB,EAACzG,EAKS0G,WAAA,WACN,OAAOrH,KAAKkH,QAChB,EAACD,CAAA,CAjCwC,CAAQV,4FCoD7B"}